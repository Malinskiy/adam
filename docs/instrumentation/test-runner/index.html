<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/adam/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/adam/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-185620090-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-185620090-1', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/adam/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/adam/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Test runner (am instrument) | Adam</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Test runner (am instrument)" /><meta property="og:locale" content="en_US" /><meta name="description" content="Test runner request" /><meta property="og:description" content="Test runner request" /><link rel="canonical" href="https://malinskiy.github.io/adam/docs/instrumentation/test-runner/" /><meta property="og:url" content="https://malinskiy.github.io/adam/docs/instrumentation/test-runner/" /><meta property="og:site_name" content="Adam" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-10T01:41:36+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Test runner (am instrument)" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://malinskiy.github.io/adam/docs/instrumentation/test-runner/"},"description":"Test runner request","url":"https://malinskiy.github.io/adam/docs/instrumentation/test-runner/","@type":"BlogPosting","headline":"Test runner (am instrument)","dateModified":"2025-02-10T01:41:36+00:00","datePublished":"2025-02-10T01:41:36+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://malinskiy.github.io/adam/assets/images/adam.png"}},"@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="https://malinskiy.github.io/adam/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><div class="nav-category">Documentation</div><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://malinskiy.github.io/adam/docs/shell" class="nav-list-link">Shell</a><ul class="nav-list "><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/shell/shell-v2/" class="nav-list-link">Shell v2</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://malinskiy.github.io/adam/docs/package-management/package-management/" class="nav-list-link">Package management</a><ul class="nav-list "><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/package-management/sideload/" class="nav-list-link">Sideload</a></ul><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/monitor-devices" class="nav-list-link">Device management</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://malinskiy.github.io/adam/docs/files" class="nav-list-link">Files</a><ul class="nav-list "><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/files/recommended/" class="nav-list-link">Recommended mode</a><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/files/compat/" class="nav-list-link">Compatibility mode</a><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/files/sync-v1/" class="nav-list-link">sync v1</a><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/files/sync-v2/" class="nav-list-link">sync v2</a><li class="nav-list-item "><a href="https://malinskiy.github.io/adam/docs/files/ls/" class="nav-list-link">ls wrapper</a></ul><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/emu" class="nav-list-link">Emulator</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/props/get-properties/" class="nav-list-link">Device properties (getprop)</a><li class="nav-list-item active"><a href="https://malinskiy.github.io/adam/docs/instrumentation/test-runner/" class="nav-list-link active">Test runner (am instrument)</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/screen-capture/screenshot/" class="nav-list-link">Screenshot</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/logcat/logcat/" class="nav-list-link">Logcat</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/port-forwarding/port-forwarding/" class="nav-list-link">Port forwarding</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/abb" class="nav-list-link">Android Binder Bridge</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/adbd" class="nav-list-link">adbd (on-device)</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/misc/misc/" class="nav-list-link">Miscellaneous</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/caveats/" class="nav-list-link">Caveats</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/docs/api/" class="nav-list-link">API</a></ul><div class="nav-category">Tutorials</div><ul class="nav-list"><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/tutorials/1-shell/" class="nav-list-link">1. Execute shell request</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/tutorials/2-logcat/" class="nav-list-link">2. Stream logcat</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/tutorials/3-install-package/" class="nav-list-link">3. Install package</a></ul><div class="nav-category">Add-ons</div><ul class="nav-list"><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/extensions/1-android-junit/" class="nav-list-link">Android JUnit 4 rules</a><li class="nav-list-item"><a href="https://malinskiy.github.io/adam/extensions/2-android-event-producers/" class="nav-list-link">Android test metric producers</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Adam" aria-label="Search Adam" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/Malinskiy/adam" class="site-button" > Adam on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"><h2 class="no_toc" id="test-runner-request"> <a href="#test-runner-request" class="anchor-heading" aria-labelledby="test-runner-request"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test runner request</h2><ol id="markdown-toc"><li><a href="#required-parameters" id="markdown-toc-required-parameters">Required parameters</a><li><a href="#runner-class" id="markdown-toc-runner-class">Runner class</a><li><a href="#no-hidden-api-checks" id="markdown-toc-no-hidden-api-checks">No hidden api checks</a><li><a href="#no-window-animation" id="markdown-toc-no-window-animation">No window animation</a><li><a href="#user-id" id="markdown-toc-user-id">User ID</a><li><a href="#abi" id="markdown-toc-abi">ABI</a><li><a href="#profiling-output" id="markdown-toc-profiling-output">Profiling output</a><li><a href="#output-log-path" id="markdown-toc-output-log-path">Output log path</a><li><a href="#instrument-options" id="markdown-toc-instrument-options">Instrument options</a><ol><li><a href="#pkg" id="markdown-toc-pkg">pkg</a><li><a href="#clazz" id="markdown-toc-clazz">clazz</a><li><a href="#functional" id="markdown-toc-functional">functional</a><li><a href="#unit" id="markdown-toc-unit">unit</a><li><a href="#filtersize" id="markdown-toc-filtersize">filterSize</a><li><a href="#performance" id="markdown-toc-performance">performance</a><li><a href="#debug" id="markdown-toc-debug">debug</a><li><a href="#log" id="markdown-toc-log">log</a><li><a href="#emma" id="markdown-toc-emma">emma</a><li><a href="#coveragefile" id="markdown-toc-coveragefile">coverageFile</a></ol></ol><p class="label label-blue">Optionally uses Feature.SHELL_V2</p><p>Executing tests can be done using the <code class="language-plaintext highlighter-rouge">TestRunnerRequest</code>:</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">channel</span><span class="p">:</span> <span class="nc">ReceiveChannel</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">TestEvents</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">adb</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
 <span class="n">request</span> <span class="p">=</span> <span class="nc">TestRunnerRequest</span><span class="p">(</span>
  <span class="n">testPackage</span> <span class="p">=</span> <span class="s">"com.example.test"</span><span class="p">,</span>
  <span class="n">instrumentOptions</span> <span class="p">=</span> <span class="nc">InstrumentOptions</span><span class="p">(</span>
   <span class="n">clazz</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"com.example.MyTest"</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">supportedFeatures</span> <span class="p">=</span> <span class="nf">emptyList</span><span class="p">(),</span>
  <span class="n">coroutineScope</span> <span class="p">=</span> <span class="nc">GlobalScope</span><span class="p">,</span>
 <span class="p">),</span>
 <span class="n">serial</span> <span class="p">=</span> <span class="s">"emulator-5554"</span>
<span class="p">)</span>

</code></pre></div></div><p>The result is a channel <code class="language-plaintext highlighter-rouge">ReadChannel&lt;List&lt;TestEvents&gt;&gt;</code> that contains parsed and converted output of the <code class="language-plaintext highlighter-rouge">am instrument</code> command.</p><h3 id="required-parameters"> <a href="#required-parameters" class="anchor-heading" aria-labelledby="required-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Required parameters</h3><p>To execute tests you have to provide the <code class="language-plaintext highlighter-rouge">testPackage</code>, default <code class="language-plaintext highlighter-rouge">InstrumentOptions()</code>, <code class="language-plaintext highlighter-rouge">coroutineScope</code> and <code class="language-plaintext highlighter-rouge">supportedFeatures</code> for the target device. Caution: you have to provide the <code class="language-plaintext highlighter-rouge">supportedFeatures</code> because newer Android devices write information into the stderr for some reason. The textual am instrument parser doesn’t support this and needs to read only stdout.</p><h3 id="runner-class"> <a href="#runner-class" class="anchor-heading" aria-labelledby="runner-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Runner class</h3><p>Default test runner class is <code class="language-plaintext highlighter-rouge">android.support.test.runner.AndroidJUnitRunner</code> but can be changed using the <code class="language-plaintext highlighter-rouge">runnerClass</code> option.</p><p>For all the options check the <a href="https://android.googlesource.com/platform/frameworks/base/+/master/cmds/am/src/com/android/commands/am/Am.java#155">source</a> of the <code class="language-plaintext highlighter-rouge">am</code> command</p><h3 id="no-hidden-api-checks"> <a href="#no-hidden-api-checks" class="anchor-heading" aria-labelledby="no-hidden-api-checks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> No hidden api checks</h3><p>Disables restrictions on the use of hidden APIs</p><h3 id="no-window-animation"> <a href="#no-window-animation" class="anchor-heading" aria-labelledby="no-window-animation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> No window animation</h3><p>Turn off window animations while running</p><h3 id="user-id"> <a href="#user-id" class="anchor-heading" aria-labelledby="user-id"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User ID</h3><p>Specify user instrumentation runs in. Defaults to current user if not specified”</p><h3 id="abi"> <a href="#abi" class="anchor-heading" aria-labelledby="abi"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ABI</h3><h3 id="profiling-output"> <a href="#profiling-output" class="anchor-heading" aria-labelledby="profiling-output"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Profiling output</h3><p>Write profiling data to specified path on the device</p><h3 id="output-log-path"> <a href="#output-log-path" class="anchor-heading" aria-labelledby="output-log-path"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Output log path</h3><p>Write test log to specified path</p><h2 id="instrument-options"> <a href="#instrument-options" class="anchor-heading" aria-labelledby="instrument-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instrument options</h2><h3 id="pkg"> <a href="#pkg" class="anchor-heading" aria-labelledby="pkg"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> pkg</h3><p>The fully-qualified Java package name for one of the packages in the test application. Any test case class that uses this package name is executed. Notice that this is not an Android package name; a test package has a single Android package name but may have several Java packages within it.</p><h3 id="clazz"> <a href="#clazz" class="anchor-heading" aria-labelledby="clazz"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> clazz</h3><p>The fully-qualified Java class name for one of the test case classes. Only this test case class is executed.</p><p>or</p><p><code class="language-plaintext highlighter-rouge">&lt;class_name&gt;#method name</code>. A fully-qualified test case class name, and one of its methods. Only this method is executed. Note the hash mark (#) between the class name and the method name.</p><h3 id="functional"> <a href="#functional" class="anchor-heading" aria-labelledby="functional"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> functional</h3><p>Runs all test classes that extend <code class="language-plaintext highlighter-rouge">InstrumentationTestCase</code>.</p><h3 id="unit"> <a href="#unit" class="anchor-heading" aria-labelledby="unit"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> unit</h3><p>Runs all test classes that do not extend either <code class="language-plaintext highlighter-rouge">InstrumentationTestCase</code> or <code class="language-plaintext highlighter-rouge">PerformanceTestCase</code>.</p><h3 id="filtersize"> <a href="#filtersize" class="anchor-heading" aria-labelledby="filtersize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> filterSize</h3><p>Runs a test method annotated by size. The annotations are <code class="language-plaintext highlighter-rouge">@SmallTest</code>, <code class="language-plaintext highlighter-rouge">@MediumTest</code>, and <code class="language-plaintext highlighter-rouge">@LargeTest</code>.</p><h3 id="performance"> <a href="#performance" class="anchor-heading" aria-labelledby="performance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> performance</h3><p>Runs all test classes that implement <code class="language-plaintext highlighter-rouge">PerformanceTestCase</code>.</p><h3 id="debug"> <a href="#debug" class="anchor-heading" aria-labelledby="debug"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> debug</h3><p>Runs tests in debug mode.</p><h3 id="log"> <a href="#log" class="anchor-heading" aria-labelledby="log"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> log</h3><p>Loads and logs all specified tests, but does not run them.</p><p>The test information appears in STDOUT. Use this to verify combinations of other filters and test specifications.</p><h3 id="emma"> <a href="#emma" class="anchor-heading" aria-labelledby="emma"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> emma</h3><p>Runs an EMMA code coverage analysis and writes the output to /data/<app_package>/coverage.ec on the device.</app_package></p><p>To override the file location, use the [coverageFile] key that is described in the following entry.</p><h3 id="coveragefile"> <a href="#coveragefile" class="anchor-heading" aria-labelledby="coveragefile"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> coverageFile</h3><p>Overrides the default location of the EMMA coverage file on the device. Specify this value as a path and filename in UNIX format. The default filename is described in the entry for the [emma] key.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Malinskiy/adam/tree/master/docs/_docs/instrumentation/test-runner.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
